{% extends 'base.html.twig' %}

{% block title  %}
    <h1>{{ spot.name }}</h1>
{% endblock %}


{% block headerElements %}

    <script src="{{ absolute_url(asset('javascript/jquery-3.4.1.slim.min.js')) }}"></script>

    <script src="{{ absolute_url(asset('javascript/highcharts.js')) }}"></script>
    {{ parent() }}
{% endblock %}

{% block body %}
    <div class="text-center">

            <div class="row">
                <div class="col-sm-5 centered">
                    {% from "windRosace/rosaceWind.html.twig" import displayRosace %}
                    {{ displayRosace("200px","200px") }}

                    <script>
                        // **************************************
                        // ** Gestion de l'orientation du vent **
                        // **************************************
                        var tabOrientationState = new Array(); // Array with orientation => state, used for rosace wind

                        getOrientationDataFromSpot();

                        // Récupére les données de l'objet spot et les pousse dans la rosace

                        function getOrientationDataFromSpot() {
                            // Parcour la liste des WindOrientation
                            {% for windOrientation in spot.windOrientation %}
                            tabOrientationState["{{ windOrientation.orientation }}"]="{{ windOrientation.state?windOrientation.state:"?" }}";
                            {% endfor %}

                            svgLoad(tabOrientationState, true);
                        }
                    </script>
                </div>

                <div class="col-sm-2 centered align-middle">
                    {{ spot.name }}<br/>
                    <div class="d-none d-sm-block">{{ spot.shortDescription|raw }}</div>
                </div>

                <div class="col-sm-5 centered">

                    {% if (spot.uRLMaree is defined) and (spot.uRLMaree is not null) %}
                        <img src="{{ asset(urlMareeImage) }}">
                    {% else %}
                        <span class="text-info">Aucune contrainte de marée</span>
                    {% endif %}

                </div>
            </div>
    </div>

    <div class="container">

        <div class="row">
            <div class="col-sm-12 center-block">
                <h3 class="hr"><a href="#spotDesc" data-toggle="collapse" class="titreCollapse">Description du spot</a></h3>
                <div id="spotDesc">{{ spot.description|raw }}</div>

            </div>
        </div>

        <h3 class="hr"><a href="#descWind" data-toggle="collapse" class="titreCollapse">Info sur l'orientation du vent</a></h3>
        <div class="row collapse show" id="descWind">
            <div class="col-sm-12">
                {{ spot.descOrientationVent|raw }}
            </div>
        </div>

    {% if spot.URLMaree|default is not empty %}
        <h3 class="hr"><a href="#descMaree" data-toggle="collapse" class="titreCollapse">Info sur les marées</a></h3>
        <div class="row collapse show" id="descMaree">
            <div class="col-sm-12">
                {{ spot.descMaree|raw }}
            </div>
        </div>
    {% endif %}

    {% if spot.descWave|default is not empty %}
        <h3 class="hr"><a href="#descWave" data-toggle="collapse" class="titreCollapse">Info sur les vagues</a></h3>
        <div class="row collapse show" id="descWave">
            <div class="col-sm-12">
                {{ spot.descWave|raw }}
            </div>
        </div>
    {% endif %}

    {% if spot.isFoil %}
        <h3 class="hr"><a href="#descFoil" data-toggle="collapse" class="titreCollapse">Info sur le foil</a></h3>
        <div class="row collapse show" id="descFoil">
            <div class="col-sm-12">
                {{ spot.descFoil|raw }}
            </div>
        </div>
    {% endif %}


    {% if spot.isContraintEte %}
        <h3 class="hr"><a href="#descEte" data-toggle="collapse" class="titreCollapse">Contrainte l'été ?</a></h3>
        <div class="row collapse show" id="descEte">
            <div class="col-sm-12">
                {{ spot.descContraintEte|raw }}
            </div>
        </div>
    {% endif %}

        <h3 class="hr"><a href="#descRoute" data-toggle="collapse" class="titreCollapse">Pour y aller</a></h3>
        <div class="row collapse show" id="descRoute">
            <div class="col-sm-12">
                {{ spot.descRoute|raw }}<br/>
                <br/>
                Distance de Paris: {{ spot.kmFromParis }}km (dont {{ spot.kmAutorouteFromParis }}km d'autoroute)<br/>
                Temps de Paris: {{ spot.timeFromParis // 60 }}h{{ spot.timeFromParis % 60 }}<br/>
                Coordonnées: ({{ spot.gpsLat }},{{ spot.gpsLong }})
            </div>
        </div>


        <h3 class="hr"><a href="#descPrev" data-toggle="collapse" class="titreCollapse">Site de prévision du vent et autres</a></h3>
        <div class="row collapse show" id="descPrev">
            <div class="col-sm-12">
                <ul>
                    <li><a href="{{ spot.urlWindFinder }}" target="_blank">Windfinder</a> </li>
                    <li><a href="{{ spot.uRLWindguru }}" target="_blank">Windguru</a> </li>
                    <li><a href="{{ spot.uRLMeteoFrance }}" target="_blank">Meteo France</a> </li>
                    <li><a href="{{ spot.uRLMeteoConsult }}" target="_blank">Meteo Consult</a> </li>
                    {% if spot.uRLMerteo|default is not empty %}
                    <li><a href="{{ spot.uRLMerteo }}" target="_blank">Merteo</a> </li>
                    {% endif %}
                    {% if spot.uRLTempWater|default is not empty %}
                    <li><a href="{{ spot.uRLTempWater }}" target="_blank">Temp de l'eau</a> </li>
                    {% endif %}
                    {% if spot.uRLMaree|default is not empty %}
                    <li><a href="{{ spot.uRLMaree }}" target="_blank">Marée</a> </li>
                    {% endif %}
                    {% if spot.urlBalise|default is not empty %}
                    <li><a href="{{ spot.urlBalise }}" target="_blank">Balise</a> </li>
                    {% endif %}
                    {% if spot.urlWebcam|default is not empty %}
                    <li><a href="{{ spot.urlWebcam }}" target="_blank">Webcam</a> </li>
                    {% endif %}
                </ul>
            </div>
        </div>

    {% if spot.webSiteInfos.count > 0 %}
        <h3 class="hr"><a href="#descPrev" data-toggle="collapse" class="titreCollapse">Sites parlant du spot</a></h3>
        <div class="row collapse show" id="descPrev">
        <div class="col-sm-12">
            <ul>
                {% for webSite in spot.webSiteInfos %}
                <li><a href="{{ webSite.url }}" target="_blank">{{ webSite.name }}</a>:{{ webSite.description|raw }} </li>
                {% endfor %}
            </ul>
        </div>
     {% endif %}



    </div>


    <div class="row">
        <div class="col-12">
            <div class="row">
                <div class="col-12">
                    <h3 class="hr">Commentaires</h3>
                </div>
            </div>
            {% for comment in spot.commentaires %}
                {% if comment.isVisible %}
            <div class="row">
                <h4>{{ comment.titre }}</h4>
                <div class="col-12">
                    {{ comment.description }}
                </div>
            </div>
                {% else %}
                    {% if app.user %}
                    <div class="row">
                        <h4>{{ comment.titre }}</h4>
                        <div class="col-11">
                            {{ comment.description }}
                        </div>
                        <div class="col-1">
                            <button class="btn-secondary" onclick="putVisibleComment({{ comment.id }})">Visible</button>
                        </div>
                    </div>
                    {% endif %}
                {% endif %}
            {% endfor %}


            <div class="row">
                <h4>Nouveau commentaire </h4>
                <div class="col-12">

                    <form action="{{ path('spot_add_comment', {'id':spot.id}) }}" method="POST"
                          id="comment_form">

                    <div class="row">
                        <div class="col-4">
                            {{ form_row(form.titre) }}
                        </div>
                        <div class="col-4">
                            {{ form_row(form.pseudo) }}
                        </div>

                        <div class="col-4">
                            {{ form_row(form.mail) }}
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-12">
                            {{ form_row(form.commentaire) }}
                        </div>
                    </div>

                    {{ form_end(form) }}

                </div>
            </div>

        </div>
    </div>

    <script>
        function putVisibleComment(idComment) {
            alert("il va falloir coder l'ajax ...");
        }
    </script>

{% endblock %}